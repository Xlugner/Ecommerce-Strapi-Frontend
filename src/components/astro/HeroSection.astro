---
import { getHeroSection, getStrapiMedia } from "../../lib/strapi";
import type { HeroSection } from "../../lib/strapi";

const heroData = await getHeroSection();
const images = heroData?.images ?? [];
---

{
  images.length > 0 && (
    <section
      id="hero-carousel"
      class="relative w-full h-64 md:h-96 overflow-hidden"
    >
      <div class="relative h-full">
        {images.map((img, index) => (
          <div
            class="carousel-item absolute w-full h-full transition-opacity duration-700 ease-in-out"
            data-index={index}
          >
            <img
              src={getStrapiMedia(img.url)}
              alt={img.alternativeText || `Slide ${index + 1}`}
              class="w-full h-full object-cover"
            />
          </div>
        ))}
      </div>

      <button class="carousel-prev absolute top-1/2 left-4 transform -translate-y-1/2 bg-transparent p-2 rounded-full hover:bg-neutral-900/75 focus:outline-none transition-colors">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 text-white"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>
      <button class="carousel-next absolute top-1/2 right-4 transform -translate-y-1/2 bg-transparent p-2 rounded-full hover:bg-neutral-900/75 focus:outline-none transition-colors">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 text-white"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>

      <div class="carousel-dots absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
        {images.map((_, index) => (
          <button
            class="carousel-dot w-3 h-3 bg-white/50 rounded-full hover:bg-white transition-colors"
            data-index={index}
          />
        ))}
      </div>
    </section>
  )
}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const carousel = document.getElementById("hero-carousel");
    if (!carousel) return;

    const items = carousel.querySelectorAll(
      ".carousel-item"
    ) as NodeListOf<HTMLElement>;
    const dots = carousel.querySelectorAll(
      ".carousel-dot"
    ) as NodeListOf<HTMLElement>;
    const prevButton = carousel.querySelector(".carousel-prev");
    const nextButton = carousel.querySelector(".carousel-next");
    let currentIndex = 0;

    if (items.length === 0) return;

    function showSlide(index: number) {
      items.forEach((item, i) => {
        item.style.opacity = i === index ? "1" : "0";
      });
      dots.forEach((dot, i) => {
        dot.classList.toggle("bg-white", i === index);
        dot.classList.toggle("bg-white/50", i !== index);
      });
      currentIndex = index;
    }

    function nextSlide() {
      const newIndex = (currentIndex + 1) % items.length;
      showSlide(newIndex);
    }

    function prevSlide() {
      const newIndex = (currentIndex - 1 + items.length) % items.length;
      showSlide(newIndex);
    }

    prevButton?.addEventListener("click", prevSlide);
    nextButton?.addEventListener("click", nextSlide);

    dots.forEach((dot, index) => {
      dot.addEventListener("click", () => {
        showSlide(index);
      });
    });

    // Auto-play
    setInterval(nextSlide, 5000);

    // Show initial slide
    showSlide(0);
  });
</script>
